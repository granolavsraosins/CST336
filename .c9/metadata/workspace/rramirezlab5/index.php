{"changed":true,"filter":false,"title":"index.php","tooltip":"/rramirezlab5/index.php","value":"<?php\n   include 'dbConnection.php'; \n   \n   $conn = getDatabaseConnection(“ottermart”);\n   \n   function displayCategories(){\n\t    global $conn;\n\t   \n\t    $sql = \"SELECT catId, catName FROM om_category ORDER BY catName\";\n\t   \t$stmt = $conn->prepare($sql); // This will send the sql you provided\n\t\t$stmt->execute(); // This will execute the sql\n\t\t$records = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\t\t\n\t    foreach ($records as $record){\n\t\t   echo \"<option value='\".$record[\"catId\"].\"'>\".$record[\"catName\"].\"</option>\";\n\t    }\n    }\n\tfunction displaySearchResults(){\n\t\tglobal $conn;\n\t\t\n\t\tif (isset($_GET['searchForm'])){//checks for user submit\n\t\t\techo \"<h3>Products Found: </h3>\";\n\t\t\t//prevents sql injection\n\t\t\t$namedParameters = array();\n\t\t\t\n\t\t\t$sql = \"SELECT * FROM om_product WHERE 1\";\n\t\t\t\n\t\t\tif(!empty($_GET['product'])){\n\t\t\t\t $sql .=  \" AND productName LIKE :productName OR productDescription LIKE :productName\";\n                 $namedParameters[\":productName\"] = \"%\" . $_GET['product'] . \"%\";\n\t\t\t}\n\t\t\tif(!empty($_GET['category'])){\n\t\t\t\t$sql .= \" AND catId = :categoryId\";\n\t\t\t\t$namedParameters[\":categoryId\"]= $_GET['category'];\n\t\t\t}\n\t\t\tif(!empty($_GET['priceFrom'])){\n\t\t\t\t$sql .= \" AND price >= :priceFrom\";\n\t\t\t\t$namedParameters[\":priceFrom\"] = $_GET['priceFrom'];\n\t\t\t}\n\t\t\tif(!empty($_GET['priceTo'])){\n\t\t\t\t$sql .= \" AND price <= :priceTo\";\n\t\t\t\t$namedParameters[\":priceTo\"] = $_GET['priceTo'];\n\t\t\t}\n\t\t\tif(isset($_GET['orderBy'])){\n\t\t\t\tif($_GET['orderBy'] == \"price\"){\n\t\t\t\t\t$sql .= \" ORDER BY price\";\n\t\t\t\t}else{\n\t\t\t\t\t$sql .= \" ORDER BY productName\";\n\t\t\t\t}\n\t\t\t}\t\n\t\t\t$stmt = $conn->prepare($sql);\n            $stmt->execute($namedParameters); // We NEED to include $namedParameters here\n            $records = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\t\t\t\n\t\t\tforeach ($records as $record){\n\t\t\t\techo \"<a href='purchaseHistory.php?productId=\".$record['productId']. \"'> History </a>\";\n\t\t\t\techo $record[\"productName\"].\" \".$record[\"productDescription\"]. \" $\" . $record[\"price\"].\"<br/><br/>\";\n\t\t\t}\n\t\t}\n\t}\t\n?>\n<!DOCTYPE html>\n<html>\n\t<head>\n\t\t<title>OtterMart Product Search</title>\n\t\t<link rel=\"stylesheet\" href=\"css/styles.css\" type=\"text/css\"/>\n\t</head>\n\t<body>\n\t\t\t<h1> OtterMart Product Search </h1>\n\t\t\t<div class=\"row\">\n\t\t\t<form>\n\t\t\t\t<div class=\"column\">\n\t\t\t\t<label>Product:</label><br>\t\t\t\t\n\t\t\t\t<input type=\"text\" name =\"product\"/>\n\t\t\t\t<br/><br/>\n\t\t\t\t<label>Category:</label> \n\t\t\t\t\t<select name=\"category\">\n\t\t\t\t\t\t<option value=\"\">Select One</option>\n\t\t\t\t\t\t<?=displayCategories()?>\n\t\t\t\t\t</select>\n\t\t\t\t<br/><br/>\n\t\t\t\t<label>Price:</label><br> \n\t\t\t\t<label>From</label>\n\t\t\t\t<input type=\"text\" name=\"priceFrom\" size=\"7\"/>\n\t\t\t\t<label>To</label>  \n\t\t\t\t<input type=\"text\" name=\"priceTo\" size=\"7\"/>\n\t\t\t\t<br/>\n\t\t\t\t<label>Order result by:</label>\n\t\t\t\t<br/>\n\t\t\t\t<input type=\"radio\" name=\"orderBy\" value=\"price\"/> Price <br/>\n\t\t\t\t<input type=\"radio\" name=\"orderBy\" value=\"name\"/> Name <br/>\n\t\t\t\t<br/><br/>\n\t\t\t\t<input type=\"submit\" value=\"Search\" name=\"searchForm\">\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t\t</div>\n\t\t\t<br/>\n\t\t\n\t\t<hr>\n\t\t<?=displaySearchResults()?>\n\t\t</div>\n\t\t<!-- Footer Info -->\n        <footer>\n            <hr>CST 336 2018&copy; Ramirez <br/>\n            <strong>Disclaimer:</strong> The information in this webpage is used for academic purposes only.<br/>\n            <img src=\"img/csumb.jpg\" alt=\"Logo of our Mascot\"/>\n        </footer>\n\t</body>\n</html>","undoManager":{"mark":-2,"position":54,"stack":[[{"start":{"row":56,"column":18},"end":{"row":56,"column":19},"action":"remove","lines":["\\"],"id":141}],[{"start":{"row":56,"column":18},"end":{"row":56,"column":19},"action":"remove","lines":["\""],"id":142}],[{"start":{"row":56,"column":18},"end":{"row":56,"column":19},"action":"insert","lines":["'"],"id":143}],[{"start":{"row":56,"column":59},"end":{"row":56,"column":60},"action":"remove","lines":["\""],"id":144}],[{"start":{"row":56,"column":59},"end":{"row":56,"column":60},"action":"insert","lines":["'"],"id":145}],[{"start":{"row":56,"column":69},"end":{"row":56,"column":70},"action":"remove","lines":["\""],"id":146}],[{"start":{"row":56,"column":69},"end":{"row":56,"column":70},"action":"insert","lines":["'"],"id":147}],[{"start":{"row":56,"column":75},"end":{"row":56,"column":76},"action":"remove","lines":["\""],"id":148}],[{"start":{"row":56,"column":75},"end":{"row":56,"column":76},"action":"insert","lines":["'"],"id":149}],[{"start":{"row":56,"column":75},"end":{"row":56,"column":76},"action":"remove","lines":["'"],"id":150},{"start":{"row":56,"column":74},"end":{"row":56,"column":75},"action":"remove","lines":["\\"]}],[{"start":{"row":56,"column":74},"end":{"row":56,"column":75},"action":"insert","lines":["'"],"id":151}],[{"start":{"row":56,"column":89},"end":{"row":56,"column":90},"action":"insert","lines":["<"],"id":152},{"start":{"row":56,"column":90},"end":{"row":56,"column":91},"action":"insert","lines":["b"]}],[{"start":{"row":56,"column":91},"end":{"row":56,"column":92},"action":"insert","lines":["t"],"id":153},{"start":{"row":56,"column":92},"end":{"row":56,"column":93},"action":"insert","lines":["r"]}],[{"start":{"row":56,"column":92},"end":{"row":56,"column":93},"action":"remove","lines":["r"],"id":154},{"start":{"row":56,"column":91},"end":{"row":56,"column":92},"action":"remove","lines":["t"]}],[{"start":{"row":56,"column":91},"end":{"row":56,"column":92},"action":"insert","lines":["r"],"id":155},{"start":{"row":56,"column":92},"end":{"row":56,"column":93},"action":"insert","lines":["."]}],[{"start":{"row":56,"column":92},"end":{"row":56,"column":93},"action":"remove","lines":["."],"id":156}],[{"start":{"row":56,"column":92},"end":{"row":56,"column":93},"action":"insert","lines":["/"],"id":157}],[{"start":{"row":56,"column":93},"end":{"row":56,"column":94},"action":"insert","lines":[">"],"id":158}],[{"start":{"row":56,"column":89},"end":{"row":56,"column":94},"action":"remove","lines":["<br/>"],"id":159}],[{"start":{"row":29,"column":4},"end":{"row":29,"column":56},"action":"remove","lines":["$sql .= \" AND productName LIKE :productDescription\";"],"id":160},{"start":{"row":29,"column":3},"end":{"row":29,"column":4},"action":"remove","lines":["\t"]},{"start":{"row":29,"column":2},"end":{"row":29,"column":3},"action":"remove","lines":["\t"]},{"start":{"row":29,"column":1},"end":{"row":29,"column":2},"action":"remove","lines":["\t"]},{"start":{"row":29,"column":0},"end":{"row":29,"column":1},"action":"remove","lines":["\t"]},{"start":{"row":28,"column":49},"end":{"row":29,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":28,"column":47},"end":{"row":28,"column":48},"action":"insert","lines":[" "],"id":161},{"start":{"row":28,"column":48},"end":{"row":28,"column":49},"action":"insert","lines":["O"]}],[{"start":{"row":28,"column":49},"end":{"row":28,"column":50},"action":"insert","lines":["R"],"id":162}],[{"start":{"row":28,"column":50},"end":{"row":28,"column":51},"action":"insert","lines":[" "],"id":163},{"start":{"row":28,"column":51},"end":{"row":28,"column":52},"action":"insert","lines":["P"]}],[{"start":{"row":28,"column":51},"end":{"row":28,"column":52},"action":"remove","lines":["P"],"id":164}],[{"start":{"row":28,"column":51},"end":{"row":28,"column":52},"action":"insert","lines":["o"],"id":165}],[{"start":{"row":28,"column":51},"end":{"row":28,"column":52},"action":"remove","lines":["o"],"id":166}],[{"start":{"row":28,"column":51},"end":{"row":28,"column":52},"action":"insert","lines":["p"],"id":167},{"start":{"row":28,"column":52},"end":{"row":28,"column":53},"action":"insert","lines":["r"]},{"start":{"row":28,"column":53},"end":{"row":28,"column":54},"action":"insert","lines":["o"]}],[{"start":{"row":28,"column":51},"end":{"row":28,"column":54},"action":"remove","lines":["pro"],"id":168},{"start":{"row":28,"column":51},"end":{"row":28,"column":62},"action":"insert","lines":["productName"]}],[{"start":{"row":28,"column":62},"end":{"row":28,"column":63},"action":"insert","lines":[" "],"id":169},{"start":{"row":28,"column":63},"end":{"row":28,"column":64},"action":"insert","lines":["L"]},{"start":{"row":28,"column":64},"end":{"row":28,"column":65},"action":"insert","lines":["I"]},{"start":{"row":28,"column":65},"end":{"row":28,"column":66},"action":"insert","lines":["K"]},{"start":{"row":28,"column":66},"end":{"row":28,"column":67},"action":"insert","lines":["E"]}],[{"start":{"row":28,"column":67},"end":{"row":28,"column":68},"action":"insert","lines":[" "],"id":170},{"start":{"row":28,"column":68},"end":{"row":28,"column":69},"action":"insert","lines":["P"]}],[{"start":{"row":28,"column":68},"end":{"row":28,"column":69},"action":"remove","lines":["P"],"id":171}],[{"start":{"row":28,"column":68},"end":{"row":28,"column":69},"action":"insert","lines":["p"],"id":172},{"start":{"row":28,"column":69},"end":{"row":28,"column":70},"action":"insert","lines":["o"]}],[{"start":{"row":28,"column":69},"end":{"row":28,"column":70},"action":"remove","lines":["o"],"id":173}],[{"start":{"row":28,"column":69},"end":{"row":28,"column":70},"action":"insert","lines":["r"],"id":174},{"start":{"row":28,"column":70},"end":{"row":28,"column":71},"action":"insert","lines":["o"]}],[{"start":{"row":28,"column":68},"end":{"row":28,"column":71},"action":"remove","lines":["pro"],"id":175},{"start":{"row":28,"column":68},"end":{"row":28,"column":86},"action":"insert","lines":["productDescription"]}],[{"start":{"row":28,"column":68},"end":{"row":28,"column":69},"action":"insert","lines":[":"],"id":176}],[{"start":{"row":28,"column":48},"end":{"row":28,"column":87},"action":"remove","lines":["OR productName LIKE :productDescription"],"id":177}],[{"start":{"row":28,"column":47},"end":{"row":28,"column":48},"action":"remove","lines":[" "],"id":178}],[{"start":{"row":28,"column":49},"end":{"row":29,"column":0},"action":"insert","lines":["",""],"id":179},{"start":{"row":29,"column":0},"end":{"row":29,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":29,"column":4},"end":{"row":29,"column":5},"action":"insert","lines":["#"]}],[{"start":{"row":29,"column":4},"end":{"row":29,"column":5},"action":"remove","lines":["#"],"id":180}],[{"start":{"row":29,"column":4},"end":{"row":29,"column":5},"action":"insert","lines":["$"],"id":181},{"start":{"row":29,"column":5},"end":{"row":29,"column":6},"action":"insert","lines":["s"]},{"start":{"row":29,"column":6},"end":{"row":29,"column":7},"action":"insert","lines":["q"]}],[{"start":{"row":29,"column":4},"end":{"row":29,"column":7},"action":"remove","lines":["$sq"],"id":182},{"start":{"row":29,"column":4},"end":{"row":29,"column":8},"action":"insert","lines":["$sql"]}],[{"start":{"row":29,"column":8},"end":{"row":29,"column":9},"action":"insert","lines":[" "],"id":183},{"start":{"row":29,"column":9},"end":{"row":29,"column":10},"action":"insert","lines":["-"]}],[{"start":{"row":29,"column":9},"end":{"row":29,"column":10},"action":"remove","lines":["-"],"id":184}],[{"start":{"row":29,"column":9},"end":{"row":29,"column":10},"action":"insert","lines":["."],"id":185},{"start":{"row":29,"column":10},"end":{"row":29,"column":11},"action":"insert","lines":["="]}],[{"start":{"row":29,"column":11},"end":{"row":29,"column":12},"action":"insert","lines":[" "],"id":186}],[{"start":{"row":29,"column":12},"end":{"row":29,"column":14},"action":"insert","lines":["\"\""],"id":187}],[{"start":{"row":29,"column":13},"end":{"row":29,"column":14},"action":"insert","lines":[" "],"id":188}],[{"start":{"row":29,"column":14},"end":{"row":29,"column":53},"action":"insert","lines":["OR productName LIKE :productDescription"],"id":189}],[{"start":{"row":29,"column":54},"end":{"row":29,"column":55},"action":"insert","lines":["'"],"id":190}],[{"start":{"row":29,"column":54},"end":{"row":29,"column":55},"action":"remove","lines":["'"],"id":191}],[{"start":{"row":29,"column":54},"end":{"row":29,"column":55},"action":"insert","lines":[";"],"id":192}],[{"start":{"row":28,"column":4},"end":{"row":30,"column":67},"action":"remove","lines":["$sql .= \" AND productName LIKE :productName\";","\t\t\t\t$sql .= \" OR productName LIKE :productDescription\";","\t\t\t\t$namedParameters[\":productName\"] = \"%\" . $_GET['product']. \"%\";"],"id":194},{"start":{"row":28,"column":4},"end":{"row":30,"column":81},"action":"insert","lines":[" $sql .=  \" AND productName LIKE :productName OR productDescription LIKE :productName\";","                 ","                 $namedParameters[\":productName\"] = \"%\" . $_GET['product'] . \"%\";"]}],[{"start":{"row":29,"column":16},"end":{"row":29,"column":17},"action":"remove","lines":[" "],"id":195},{"start":{"row":29,"column":15},"end":{"row":29,"column":16},"action":"remove","lines":[" "]},{"start":{"row":29,"column":14},"end":{"row":29,"column":15},"action":"remove","lines":[" "]},{"start":{"row":29,"column":13},"end":{"row":29,"column":14},"action":"remove","lines":[" "]},{"start":{"row":29,"column":12},"end":{"row":29,"column":13},"action":"remove","lines":[" "]},{"start":{"row":29,"column":11},"end":{"row":29,"column":12},"action":"remove","lines":[" "]},{"start":{"row":29,"column":10},"end":{"row":29,"column":11},"action":"remove","lines":[" "]},{"start":{"row":29,"column":9},"end":{"row":29,"column":10},"action":"remove","lines":[" "]},{"start":{"row":29,"column":8},"end":{"row":29,"column":9},"action":"remove","lines":[" "]},{"start":{"row":29,"column":7},"end":{"row":29,"column":8},"action":"remove","lines":[" "]},{"start":{"row":29,"column":6},"end":{"row":29,"column":7},"action":"remove","lines":[" "]}],[{"start":{"row":29,"column":5},"end":{"row":29,"column":6},"action":"remove","lines":[" "],"id":196},{"start":{"row":29,"column":4},"end":{"row":29,"column":5},"action":"remove","lines":[" "]},{"start":{"row":29,"column":3},"end":{"row":29,"column":4},"action":"remove","lines":[" "]},{"start":{"row":29,"column":2},"end":{"row":29,"column":3},"action":"remove","lines":[" "]},{"start":{"row":29,"column":1},"end":{"row":29,"column":2},"action":"remove","lines":[" "]},{"start":{"row":29,"column":0},"end":{"row":29,"column":1},"action":"remove","lines":[" "]},{"start":{"row":28,"column":91},"end":{"row":29,"column":0},"action":"remove","lines":["",""]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":28,"column":91},"end":{"row":28,"column":91},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1541873017513}